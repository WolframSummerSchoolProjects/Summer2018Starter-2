(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='WolframDesktop 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       161,          7]
NotebookDataLength[     86596,       2017]
NotebookOptionsPosition[     82549,       1962]
NotebookOutlinePosition[     82896,       1977]
CellTagsIndexPosition[     82853,       1974]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 StyleBox[
  RowBox[{"MNIST", " ", "Data", " ", "fetch", " "}], "Subtitle",
  FontWeight->"Bold"]], "Input",
 CellChangeTimes->{{3.7395617607210855`*^9, 
  3.7395617659792604`*^9}},ExpressionUUID->"6333c42e-87f7-4bf2-9c52-\
ef4b9536a477"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"prepareData", "[", "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "tx", ",", " ", "tt", ",", " ", "ty", ",", "txT", ",", " ", "ttT", ",", 
       " ", "tyT", ",", " ", "i", ",", " ", "training", ",", " ", "testing"}],
       "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"training", " ", "=", " ", 
       RowBox[{"RandomSample", "[", 
        RowBox[{"ExampleData", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<MachineLearning\>\"", ",", "\"\<MNIST\>\""}], "}"}], 
          ",", "\"\<TrainingData\>\""}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"testing", " ", "=", " ", 
       RowBox[{"RandomSample", "[", 
        RowBox[{"ExampleData", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<MachineLearning\>\"", ",", " ", "\"\<MNIST\>\""}], 
           "}"}], ",", " ", "\"\<TestData\>\""}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"txT", " ", "=", " ", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{"ImageData", ",", " ", 
           RowBox[{"testing", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", " ", "1"}], "]"}], "]"}]}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"10000", ",", " ", "784"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ttT", " ", "=", " ", 
       RowBox[{"testing", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tyT", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"10000", ",", " ", "10"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", "10000"}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"tyT", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", " ", 
             RowBox[{"1", "+", 
              RowBox[{"ttT", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], "]"}], " ", "=", 
          " ", "1"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"tx", " ", "=", " ", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{"ImageData", ",", " ", 
           RowBox[{"training", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", " ", "1"}], "]"}], "]"}]}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"60000", ",", " ", "784"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tt", "  ", "=", " ", 
       RowBox[{"training", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ty", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"60000", ",", " ", "10"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", "60000"}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ty", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", " ", 
             RowBox[{"1", "+", 
              RowBox[{"tt", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], "]"}], " ", "=", 
          " ", "1"}], ";"}]}], "]"}], ";", " ", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"tx", ",", " ", "ty", ",", " ", "txT", ",", " ", "tyT"}], 
        "}"}], "]"}], ";"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "input", ",", " ", "target", ",", " ", "testinp", ",", " ", "testtar"}], 
    "}"}], " ", "=", " ", 
   RowBox[{"prepareData", "[", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7395617677082987`*^9, 3.7395617699307814`*^9}, {
  3.7396334647553473`*^9, 3.739633465297883*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"8229eef7-ddc5-47a6-a2f7-97999efcea5e"],

Cell[BoxData[
 StyleBox[
  RowBox[{"Xavier", " ", "Initialization", " ", "of", " ", "network", " "}], 
  "Subtitle",
  FontWeight->"Bold"]], "Input",
 CellChangeTimes->{{3.739561781963962*^9, 
  3.7395617819659567`*^9}},ExpressionUUID->"2d85b99e-e859-45fe-aa2a-\
950054761b9e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"initializeWeights", "[", 
    RowBox[{
    "hiddennodes1_", ",", " ", "hiddennodes2_", ",", " ", "outputnodes_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "mininet", ",", " ", "netinit", ",", " ", "w0", ",", " ", "w1", ",", 
       " ", "w2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mininet", " ", "=", " ", 
       RowBox[{"NetChain", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"LinearLayer", "[", "hiddennodes1", "]"}], ",", " ", 
           "Ramp", ",", 
           RowBox[{"LinearLayer", "[", "hiddennodes2", "]"}], ",", " ", 
           "Ramp", ",", " ", 
           RowBox[{"LinearLayer", "[", "outputnodes", "]"}], ",", " ", 
           "LogisticSigmoid"}], "}"}], ",", " ", 
         RowBox[{"\"\<Input\>\"", "\[Rule]", "784"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"netinit", " ", "=", " ", 
       RowBox[{"NetInitialize", "[", 
        RowBox[{"mininet", ",", " ", 
         RowBox[{"Method", " ", "\[Rule]", 
          RowBox[{"{", "\"\<Xavier\>\"", "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w0", " ", "=", " ", 
       RowBox[{"Transpose", "@", 
        RowBox[{
         RowBox[{"NetExtract", "[", 
          RowBox[{"netinit", ",", " ", 
           RowBox[{"{", 
            RowBox[{"All", ",", " ", "\"\<Weights\>\""}], "}"}]}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"w1", " ", "=", " ", 
       RowBox[{"Transpose", "@", 
        RowBox[{
         RowBox[{"NetExtract", "[", 
          RowBox[{"netinit", ",", " ", 
           RowBox[{"{", 
            RowBox[{"All", ",", " ", "\"\<Weights\>\""}], "}"}]}], "]"}], "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"w2", " ", "=", " ", 
       RowBox[{"Transpose", "@", 
        RowBox[{
         RowBox[{"NetExtract", "[", 
          RowBox[{"netinit", ",", " ", 
           RowBox[{"{", 
            RowBox[{"All", ",", " ", "\"\<Weights\>\""}], "}"}]}], "]"}], "[", 
         RowBox[{"[", "5", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"w0", ",", " ", "w1", ",", " ", "w2"}], "}"}], "]"}], ";"}]}],
     "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.739568987034275*^9, 3.7395689878151846`*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"2981b838-8492-4e60-a8e1-78f57677bf64"],

Cell[BoxData[
 StyleBox[
  RowBox[{"Define", " ", "network", " ", "variables"}], "Subtitle",
  FontWeight->"Bold"]], "Input",
 CellChangeTimes->{{3.739561787772089*^9, 
  3.7395617877750673`*^9}},ExpressionUUID->"05e424f5-5bc8-4626-b94a-\
30e25d2d6108"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"learningrate", " ", "=", " ", "0.00003"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"binAggression", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hiddennodes1", " ", "=", " ", "128"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hiddennodes2", " ", "=", " ", "128"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outputnodes", " ", "=", " ", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"batchsize", " ", "=", " ", "16"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iterations", " ", "=", " ", 
   RowBox[{"Floor", "[", 
    RowBox[{"60000", "/", "batchsize"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epochs", " ", "=", " ", "50"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b1", " ", "=", " ", "0.9"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b2", " ", "=", " ", "0.999"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epsilon", " ", "=", " ", "0.00000001"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inputdim", "  ", "=", " ", "784"}], ";"}]}], "Input",
 CellChangeTimes->{{3.739565612420392*^9, 3.7395656140133944`*^9}, {
   3.7395677842786617`*^9, 3.7395677880326242`*^9}, {3.739567891451046*^9, 
   3.7395678991753798`*^9}, {3.739569188082343*^9, 3.739569191183061*^9}, {
   3.739569346106138*^9, 3.7395693463983707`*^9}, {3.7395696706401925`*^9, 
   3.739569673519461*^9}, {3.7395702306050615`*^9, 3.7395702308244915`*^9}, {
   3.7395704593427057`*^9, 3.7395704750327263`*^9}, {3.7395711703499002`*^9, 
   3.7395711735293837`*^9}, 3.7395767074858584`*^9, 3.7395884852711544`*^9, {
   3.7395888596784735`*^9, 3.7395888598061347`*^9}},
 CellLabel->
  "In[110]:=",ExpressionUUID->"a3598894-949b-4a67-b2de-57863b0c499b"],

Cell[BoxData[
 StyleBox[
  RowBox[{
   StyleBox[
    RowBox[{"H", 
     StyleBox["a", "Subtitle",
      FontWeight->"Bold"], "damard"}]], 
   StyleBox[
    StyleBox[" ", "Subtitle",
     FontWeight->"Bold"], "Subtitle",
    FontWeight->"Bold"], "Binarization", " ", "functions"}], "Subtitle",
  FontWeight->"Bold"]], "Input",
 CellChangeTimes->{{3.739561826627942*^9, 3.7395618309775496`*^9}, {
  3.7395845310096846`*^9, 
  3.7395845324873695`*^9}},ExpressionUUID->"343c3ee5-345a-40f1-8669-\
79e0ae084770"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"hbGradForward", "[", 
      RowBox[{"x_", ",", " ", "hBL_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Join", "@@@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Sign", "[", 
           RowBox[{"x", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", 
              RowBox[{"1", ";;", 
               RowBox[{"hBL", "*", 
                RowBox[{
                 RowBox[{"Floor", "[", 
                  RowBox[{
                   RowBox[{"Dimensions", "@", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "/", "hBL"}], "]"}], 
                 "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}]}]}], "]"}], "]"}], "]"}], 
          "*", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "@", 
              RowBox[{"Transpose", "@", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Map", "[", 
                   RowBox[{"Max", ",", " ", 
                    RowBox[{"Abs", "@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", 
                    RowBox[{"#", ";;", 
                    RowBox[{"#", "+", "hBL", "-", "1"}]}]}], "]"}], "]"}], 
                    "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{"1", ",", " ", 
                    RowBox[{
                    RowBox[{"Dimensions", "@", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "-", "hBL", "+", "1"}], 
                    ",", " ", "hBL"}], "]"}], "]"}], ")"}]}], "]"}]}], ",", 
                    " ", 
                    RowBox[{"{", "2", "}"}]}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"#", ",", ";;"}], "]"}], "]"}], ",", " ", "hBL"}], 
                "]"}]}]}], "&"}], "/@", 
            RowBox[{"Range", "[", 
             RowBox[{
              RowBox[{"Dimensions", "[", "x", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ",", " ", 
         RowBox[{
          RowBox[{"Sign", "[", 
           RowBox[{"x", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 RowBox[{"hBL", "*", 
                  RowBox[{
                   RowBox[{"Floor", "[", 
                    RowBox[{
                    RowBox[{"Dimensions", "@", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "/", "hBL"}], "]"}], 
                   "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}], ";;"}]}], "]"}],
             "]"}], "]"}], "*", 
          RowBox[{"Max", "[", 
           RowBox[{"x", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 RowBox[{"hBL", "*", 
                  RowBox[{
                   RowBox[{"Floor", "[", 
                    RowBox[{
                    RowBox[{"Dimensions", "@", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "/", "hBL"}], "]"}], 
                   "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}], ";;"}]}], "]"}],
             "]"}], "]"}]}]}], "}"}], "]"}]}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"hbGradForward", "[", 
      RowBox[{"x_", ",", " ", "hBL_"}], "]"}], " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "row", ",", " ", "col", ",", "tempMat", ",", " ", "matCreate", ",", 
         " ", "joinerMat", ",", " ", "x2"}], "}"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"x2", " ", "=", " ", "x"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"col", " ", "=", " ", "1"}], ",", " ", 
          RowBox[{"col", " ", "\[LessEqual]", " ", 
           RowBox[{
            RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
          RowBox[{"col", "++"}], ",", 
          RowBox[{
           RowBox[{"matCreate", " ", "=", " ", 
            RowBox[{"Abs", "[", 
             RowBox[{"ArrayReshape", "[", 
              RowBox[{
               RowBox[{"x2", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", " ", "col"}], "]"}], "]"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Ceiling", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/", "hBL"}], "]"}], ",", 
                 "hBL"}], "}"}], ",", " ", "0"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tempMat", " ", "=", " ", 
            RowBox[{"Map", "[", 
             RowBox[{"Max", ",", " ", 
              RowBox[{"matCreate", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], ",", " ", ";;"}], "]"}], "]"}], ",", 
              " ", 
              RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tempMat", ",", " ", 
             RowBox[{"Max", "[", 
              RowBox[{"matCreate", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", " ", ";;"}], "]"}], "]"}], "]"}]}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"row", " ", "=", " ", "1"}], ",", " ", 
             RowBox[{"row", " ", "\[LessEqual]", " ", 
              RowBox[{
               RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
             RowBox[{"row", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"x2", "[", 
                RowBox[{"[", 
                 RowBox[{"row", ",", " ", "col"}], "]"}], "]"}], " ", "=", 
               " ", 
               RowBox[{
                RowBox[{"Sign", "[", 
                 RowBox[{"x2", "[", 
                  RowBox[{"[", 
                   RowBox[{"row", ",", " ", "col"}], "]"}], "]"}], "]"}], "*", 
                RowBox[{"tempMat", "[", 
                 RowBox[{"[", 
                  RowBox[{"Ceiling", "[", 
                   RowBox[{"row", "/", "hBL"}], "]"}], "]"}], "]"}]}]}], 
              ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "x2", "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hbBackward", "[", "x_", "]"}], " ", ":=", " ", 
     RowBox[{"Clip", "[", 
      RowBox[{"x", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", " ", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", " ", "0"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hbWForward", "[", 
      RowBox[{"x_", ",", " ", "hBL_"}], "]"}], " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "row", ",", " ", "col", ",", "tempMat", ",", " ", "matCreate", ",", 
         " ", "joinerMat", ",", " ", "x2"}], "}"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"x2", " ", "=", " ", "x"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"col", " ", "=", " ", "1"}], ",", " ", 
          RowBox[{"col", " ", "\[LessEqual]", " ", 
           RowBox[{
            RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
          RowBox[{"col", "++"}], ",", 
          RowBox[{
           RowBox[{"matCreate", " ", "=", " ", 
            RowBox[{"Abs", "[", 
             RowBox[{"ArrayReshape", "[", 
              RowBox[{
               RowBox[{"x2", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", " ", "col"}], "]"}], "]"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Ceiling", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/", "hBL"}], "]"}], ",", 
                 "hBL"}], "}"}], ",", " ", "0"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tempMat", " ", "=", " ", 
            RowBox[{"Map", "[", 
             RowBox[{"Mean", ",", " ", 
              RowBox[{"matCreate", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], ",", " ", ";;"}], "]"}], "]"}], ",", 
              " ", 
              RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", "hBL"}], "]"}], 
              "\[NotEqual]", " ", "0"}], ",", "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"tempMat", ",", " ", 
               RowBox[{
                RowBox[{"Total", "[", 
                 RowBox[{"matCreate", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", " ", ";;"}], "]"}], "]"}], "]"}],
                 "/", 
                RowBox[{"Mod", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", " ", "hBL"}], 
                 "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"tempMat", ",", " ", 
               RowBox[{"Mean", "[", 
                RowBox[{"matCreate", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", " ", ";;"}], "]"}], "]"}], 
                "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"row", " ", "=", " ", "1"}], ",", " ", 
             RowBox[{"row", " ", "\[LessEqual]", " ", 
              RowBox[{
               RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
             RowBox[{"row", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"x2", "[", 
                RowBox[{"[", 
                 RowBox[{"row", ",", " ", "col"}], "]"}], "]"}], " ", "=", 
               " ", 
               RowBox[{
                RowBox[{"Sign", "[", 
                 RowBox[{"x2", "[", 
                  RowBox[{"[", 
                   RowBox[{"row", ",", " ", "col"}], "]"}], "]"}], "]"}], "*", 
                RowBox[{"tempMat", "[", 
                 RowBox[{"[", 
                  RowBox[{"Ceiling", "[", 
                   RowBox[{"row", "/", "hBL"}], "]"}], "]"}], "]"}]}]}], 
              ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "x2", "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hbActForward", "[", 
      RowBox[{"x_", ",", " ", "hBL_"}], "]"}], " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "row", ",", " ", "col", ",", "tempMat", ",", " ", "matCreate", ",", 
         " ", "joinerMat", ",", " ", "x2"}], "}"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"x2", " ", "=", " ", 
         RowBox[{"Transpose", "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"col", " ", "=", " ", "1"}], ",", " ", 
          RowBox[{"col", " ", "\[LessEqual]", " ", 
           RowBox[{
            RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
          RowBox[{"col", "++"}], ",", 
          RowBox[{
           RowBox[{"matCreate", " ", "=", " ", 
            RowBox[{"Abs", "[", 
             RowBox[{"ArrayReshape", "[", 
              RowBox[{
               RowBox[{"x2", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", " ", "col"}], "]"}], "]"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Ceiling", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/", "hBL"}], "]"}], ",", 
                 "hBL"}], "}"}], ",", " ", "0"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tempMat", " ", "=", " ", 
            RowBox[{"Map", "[", 
             RowBox[{"Mean", ",", " ", 
              RowBox[{"matCreate", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{";;", 
                  RowBox[{"-", "2"}]}], ",", " ", ";;"}], "]"}], "]"}], ",", 
              " ", 
              RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", "hBL"}], "]"}], 
              "\[NotEqual]", " ", "0"}], ",", "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"tempMat", ",", " ", 
               RowBox[{
                RowBox[{"Total", "[", 
                 RowBox[{"matCreate", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", " ", ";;"}], "]"}], "]"}], "]"}],
                 "/", 
                RowBox[{"Mod", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", " ", "hBL"}], 
                 "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"tempMat", ",", " ", 
               RowBox[{"Mean", "[", 
                RowBox[{"matCreate", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", " ", ";;"}], "]"}], "]"}], 
                "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"row", " ", "=", " ", "1"}], ",", " ", 
             RowBox[{"row", " ", "\[LessEqual]", " ", 
              RowBox[{
               RowBox[{"Dimensions", "[", "x2", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
             RowBox[{"row", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"x2", "[", 
                RowBox[{"[", 
                 RowBox[{"row", ",", " ", "col"}], "]"}], "]"}], " ", "=", 
               " ", 
               RowBox[{
                RowBox[{"Sign", "[", 
                 RowBox[{"x2", "[", 
                  RowBox[{"[", 
                   RowBox[{"row", ",", " ", "col"}], "]"}], "]"}], "]"}], "*", 
                RowBox[{"tempMat", "[", 
                 RowBox[{"[", 
                  RowBox[{"Ceiling", "[", 
                   RowBox[{"row", "/", "hBL"}], "]"}], "]"}], "]"}]}]}], 
              ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"Transpose", "[", "x2", "]"}], "]"}]}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7395618323377304`*^9, 3.7395618540661335`*^9}, {
   3.73956188930412*^9, 3.7395619082766542`*^9}, {3.739561960447143*^9, 
   3.7395619785341015`*^9}, {3.7395620336076946`*^9, 3.739562042142571*^9}, {
   3.7395621821157913`*^9, 3.739562212240314*^9}, {3.739584269959426*^9, 
   3.739584288751565*^9}, {3.739584393010781*^9, 3.7395844416051097`*^9}, {
   3.739584616853136*^9, 3.73958461845186*^9}, {3.739584777572684*^9, 
   3.7395847777242765`*^9}, {3.73958729539404*^9, 3.739587300790635*^9}, {
   3.7395876852761974`*^9, 3.739587691565344*^9}, {3.739587768519455*^9, 
   3.7395877704423127`*^9}, {3.739587885664836*^9, 3.7395879021086473`*^9}, {
   3.739588070185936*^9, 3.739588077897309*^9}, 3.739633128853849*^9, {
   3.7396333314109635`*^9, 3.7396333572011366`*^9}, {3.7396333879534116`*^9, 
   3.739633396281217*^9}, {3.7396339127839766`*^9, 3.739633948500042*^9}, {
   3.7396344044639034`*^9, 3.7396344765088215`*^9}, {3.7396345801173544`*^9, 
   3.739634595098478*^9}},
 CellLabel->
  "In[237]:=",ExpressionUUID->"f6633890-c759-4ccb-88de-5f880763ddc6"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"tester", " ", "=", " ", 
   RowBox[{"RandomVariate", "[", 
    RowBox[{
     RowBox[{"NormalDistribution", "[", "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"11", ",", " ", "7"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"tester", "//", "MatrixForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hbWForward", "[", 
   RowBox[{"tester", ",", " ", "4"}], "]"}], "//", 
  "MatrixForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hbActForward", "[", 
   RowBox[{"tester", ",", "4"}], "]"}], "//", 
  "MatrixForm"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.73958814548086*^9, 3.739588189101438*^9}, {
  3.7395888116469765`*^9, 3.7395888118225102`*^9}, {3.739588851956133*^9, 
  3.7395888521067324`*^9}, {3.739588888082312*^9, 3.7395888956470428`*^9}, {
  3.7395889549633455`*^9, 3.7395889841043806`*^9}, {3.739633134724843*^9, 
  3.73963313520555*^9}, {3.7396339527870784`*^9, 3.7396339623885403`*^9}, {
  3.7396340002549143`*^9, 3.739634081621363*^9}, {3.739634130651366*^9, 
  3.7396341430760837`*^9}, {3.7396342609639025`*^9, 3.7396342738956633`*^9}, {
  3.7396343531156497`*^9, 3.739634357063486*^9}, {3.739634393920173*^9, 
  3.7396343942779093`*^9}, {3.739634576409425*^9, 3.739634634772709*^9}},
 CellLabel->
  "In[233]:=",ExpressionUUID->"0c819410-cf50-4d93-9f66-11fa5c112620"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"-", "0.8703081610549221`"}], "0.11813350901949117`", 
      RowBox[{"-", "1.343780426681949`"}], "0.42871357638414687`", 
      RowBox[{"-", "0.8854584257290113`"}], 
      RowBox[{"-", "0.6605544223729973`"}], "0.4370306319133049`"},
     {"0.10721390119393212`", 
      RowBox[{"-", "0.022153369342820056`"}], 
      RowBox[{"-", "0.92963179624004`"}], 
      RowBox[{"-", "1.5870248605803632`"}], 
      RowBox[{"-", "0.07939906353785905`"}], 
      RowBox[{"-", "0.4749568988396055`"}], 
      RowBox[{"-", "0.8290733374084067`"}]},
     {"1.155769769549935`", 
      RowBox[{"-", "0.02320077579614739`"}], 
      RowBox[{"-", "0.37853479871866835`"}], "0.32884279549438106`", 
      RowBox[{"-", "0.19056876144812537`"}], 
      RowBox[{"-", "1.1271513995284799`"}], "0.33495750999449714`"},
     {
      RowBox[{"-", "0.8161532334357203`"}], 
      RowBox[{"-", "0.4991481700528142`"}], 
      RowBox[{"-", "0.5896902535678652`"}], 
      RowBox[{"-", "1.3691256728499492`"}], "0.22474136515697016`", 
      RowBox[{"-", "0.7783369846530196`"}], "2.222195583810003`"},
     {"0.7634010188721524`", "0.1961115560806269`", "0.5702379265563473`", 
      RowBox[{"-", "0.1968805896695952`"}], 
      RowBox[{"-", "0.8002864133359477`"}], "1.8272656737928934`", 
      "1.6865049788771669`"},
     {
      RowBox[{"-", "1.5190418944820323`"}], 
      RowBox[{"-", "0.4409810697769007`"}], "0.6574103924766838`", 
      RowBox[{"-", "0.19272371908166647`"}], 
      RowBox[{"-", "0.23576409909150978`"}], 
      RowBox[{"-", "1.4465958841251934`"}], "2.0732306287395987`"},
     {"0.42395169132723964`", 
      RowBox[{"-", "0.5790476296804479`"}], 
      RowBox[{"-", "2.0204661221711424`"}], "0.18580309804741466`", 
      RowBox[{"-", "0.015163730024918451`"}], "1.0219252694057772`", 
      RowBox[{"-", "1.8495915943001684`"}]},
     {"0.18687346896193058`", "0.394049235795768`", "0.4270063341110735`", 
      RowBox[{"-", "0.10692078370040815`"}], "0.7651225616079772`", 
      RowBox[{"-", "0.4436394856074038`"}], "0.14571515643599012`"},
     {"0.9747834601941443`", 
      RowBox[{"-", "1.4911915248813712`"}], "0.1119129517614976`", 
      RowBox[{"-", "0.6507299864878442`"}], "0.2426313558727343`", 
      RowBox[{"-", "0.5266372127295598`"}], 
      RowBox[{"-", "0.5921837424499157`"}]},
     {
      RowBox[{"-", "0.5844981299763933`"}], "0.048318097754429676`", 
      RowBox[{"-", "0.01926376086670993`"}], 
      RowBox[{"-", "0.8241792446122056`"}], 
      RowBox[{"-", "0.04861598390536782`"}], "1.529577590893558`", 
      "0.92743128129783`"},
     {
      RowBox[{"-", "0.9940886913451358`"}], 
      RowBox[{"-", "1.399591432936535`"}], "0.2552768532648474`", 
      RowBox[{"-", "0.9487507821524958`"}], 
      RowBox[{"-", "1.2615178723775784`"}], "0.1383157626236636`", 
      "0.3603768727539781`"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.7396346352671614`*^9},
 CellLabel->
  "Out[234]//MatrixForm=",ExpressionUUID->"f119378d-6aa0-4a48-9aa7-\
72cb61c8e871"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"-", "0.7373612663086274`"}], "0.16565895605281822`", 
      RowBox[{"-", "0.8104093188021306`"}], "0.9284267263272101`", 
      RowBox[{"-", "0.34504190396799145`"}], 
      RowBox[{"-", "0.7602499263485255`"}], "0.9558142657815529`"},
     {"0.7373612663086274`", 
      RowBox[{"-", "0.16565895605281822`"}], 
      RowBox[{"-", "0.8104093188021306`"}], 
      RowBox[{"-", "0.9284267263272101`"}], 
      RowBox[{"-", "0.34504190396799145`"}], 
      RowBox[{"-", "0.7602499263485255`"}], 
      RowBox[{"-", "0.9558142657815529`"}]},
     {"0.7373612663086274`", 
      RowBox[{"-", "0.16565895605281822`"}], 
      RowBox[{"-", "0.8104093188021306`"}], "0.9284267263272101`", 
      RowBox[{"-", "0.34504190396799145`"}], 
      RowBox[{"-", "0.7602499263485255`"}], "0.9558142657815529`"},
     {
      RowBox[{"-", "0.7373612663086274`"}], 
      RowBox[{"-", "0.16565895605281822`"}], 
      RowBox[{"-", "0.8104093188021306`"}], 
      RowBox[{"-", "0.9284267263272101`"}], "0.34504190396799145`", 
      RowBox[{"-", "0.7602499263485255`"}], "0.9558142657815529`"},
     {"0.7233170184108387`", "0.4025473728334359`", "0.9187801938288117`", 
      RowBox[{"-", "0.1705820476247711`"}], 
      RowBox[{"-", "0.4540842010150883`"}], "1.184856578232817`", 
      "1.4387605895882312`"},
     {
      RowBox[{"-", "0.7233170184108387`"}], 
      RowBox[{"-", "0.4025473728334359`"}], "0.9187801938288117`", 
      RowBox[{"-", "0.1705820476247711`"}], 
      RowBox[{"-", "0.4540842010150883`"}], 
      RowBox[{"-", "1.184856578232817`"}], "1.4387605895882312`"},
     {"0.7233170184108387`", 
      RowBox[{"-", "0.4025473728334359`"}], 
      RowBox[{"-", "0.9187801938288117`"}], "0.1705820476247711`", 
      RowBox[{"-", "0.4540842010150883`"}], "1.184856578232817`", 
      RowBox[{"-", "1.4387605895882312`"}]},
     {"0.7233170184108387`", "0.4025473728334359`", "0.9187801938288117`", 
      RowBox[{"-", "0.1705820476247711`"}], "0.4540842010150883`", 
      RowBox[{"-", "1.184856578232817`"}], "1.4387605895882312`"},
     {"0.8511234271718912`", 
      RowBox[{"-", "0.9797003518574453`"}], "0.12881785529768497`", 
      RowBox[{"-", "0.8078866710841819`"}], "0.5175884040518934`", 
      RowBox[{"-", "0.7315101887489273`"}], 
      RowBox[{"-", "0.6266639655005746`"}]},
     {
      RowBox[{"-", "0.8511234271718912`"}], "0.9797003518574453`", 
      RowBox[{"-", "0.12881785529768497`"}], 
      RowBox[{"-", "0.8078866710841819`"}], 
      RowBox[{"-", "0.5175884040518934`"}], "0.7315101887489273`", 
      "0.6266639655005746`"},
     {
      RowBox[{"-", "0.8511234271718912`"}], 
      RowBox[{"-", "0.9797003518574453`"}], "0.12881785529768497`", 
      RowBox[{"-", "0.8078866710841819`"}], 
      RowBox[{"-", "0.5175884040518934`"}], "0.7315101887489273`", 
      "0.6266639655005746`"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.7396346352831173`*^9},
 CellLabel->
  "Out[235]//MatrixForm=",ExpressionUUID->"ce34c885-41a5-46d4-bab2-\
8971e67b5ae4"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"-", "0.6902339182851273`"}], "0.6902339182851273`", 
      RowBox[{"-", "0.6902339182851273`"}], "0.6902339182851273`", 
      RowBox[{"-", "0.6610144933384379`"}], 
      RowBox[{"-", "0.6610144933384379`"}], "0.6610144933384379`"},
     {"0.6615059818392888`", 
      RowBox[{"-", "0.6615059818392888`"}], 
      RowBox[{"-", "0.6615059818392888`"}], 
      RowBox[{"-", "0.6615059818392888`"}], 
      RowBox[{"-", "0.46114309992862373`"}], 
      RowBox[{"-", "0.46114309992862373`"}], 
      RowBox[{"-", "0.46114309992862373`"}]},
     {"0.471587034889783`", 
      RowBox[{"-", "0.471587034889783`"}], 
      RowBox[{"-", "0.471587034889783`"}], "0.471587034889783`", 
      RowBox[{"-", "0.5508925569903674`"}], 
      RowBox[{"-", "0.5508925569903674`"}], "0.5508925569903674`"},
     {
      RowBox[{"-", "0.8185293324765872`"}], 
      RowBox[{"-", "0.8185293324765872`"}], 
      RowBox[{"-", "0.8185293324765872`"}], 
      RowBox[{"-", "0.8185293324765872`"}], "1.0750913112066642`", 
      RowBox[{"-", "1.0750913112066642`"}], "1.0750913112066642`"},
     {"0.4316577727946804`", "0.4316577727946804`", "0.4316577727946804`", 
      RowBox[{"-", "0.4316577727946804`"}], 
      RowBox[{"-", "1.4380190220020026`"}], "1.4380190220020026`", 
      "1.4380190220020026`"},
     {
      RowBox[{"-", "0.7025392689543208`"}], 
      RowBox[{"-", "0.7025392689543208`"}], "0.7025392689543208`", 
      RowBox[{"-", "0.7025392689543208`"}], 
      RowBox[{"-", "1.2518635373187672`"}], 
      RowBox[{"-", "1.2518635373187672`"}], "1.2518635373187672`"},
     {"0.8023171353065611`", 
      RowBox[{"-", "0.8023171353065611`"}], 
      RowBox[{"-", "0.8023171353065611`"}], "0.8023171353065611`", 
      RowBox[{"-", "0.9622268645769547`"}], "0.9622268645769547`", 
      RowBox[{"-", "0.9622268645769547`"}]},
     {"0.2787124556422951`", "0.2787124556422951`", "0.2787124556422951`", 
      RowBox[{"-", "0.2787124556422951`"}], "0.45149240121712375`", 
      RowBox[{"-", "0.45149240121712375`"}], "0.45149240121712375`"},
     {"0.8071544808312143`", 
      RowBox[{"-", "0.8071544808312143`"}], "0.8071544808312143`", 
      RowBox[{"-", "0.8071544808312143`"}], "0.4538174370174032`", 
      RowBox[{"-", "0.4538174370174032`"}], 
      RowBox[{"-", "0.4538174370174032`"}]},
     {
      RowBox[{"-", "0.3690648083024346`"}], "0.3690648083024346`", 
      RowBox[{"-", "0.3690648083024346`"}], 
      RowBox[{"-", "0.3690648083024346`"}], 
      RowBox[{"-", "0.8352082853655853`"}], "0.8352082853655853`", 
      "0.8352082853655853`"},
     {
      RowBox[{"-", "0.8994269399247535`"}], 
      RowBox[{"-", "0.8994269399247535`"}], "0.8994269399247535`", 
      RowBox[{"-", "0.8994269399247535`"}], 
      RowBox[{"-", "0.5867368359184066`"}], "0.5867368359184066`", 
      "0.5867368359184066`"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.7396346353000746`*^9},
 CellLabel->
  "Out[236]//MatrixForm=",ExpressionUUID->"e03c4874-c956-4c8c-a4f6-\
73a095546d80"]
}, Open  ]],

Cell[BoxData[
 StyleBox[
  RowBox[{"Derivative", " ", "functions"}], "Subtitle",
  FontWeight->"Bold"]], "Input",ExpressionUUID->"53fda235-5223-4e36-9c0b-\
ec505edc1d68"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sigmDeriv", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{"Return", "[", 
    RowBox[{"x", "*", 
     RowBox[{"(", 
      RowBox[{"1", "-", "x"}], ")"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rampDeriv", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{"Return", "[", 
    RowBox[{"UnitStep", "[", "x", "]"}], "]"}]}], ";"}]}], "Input",
 CellLabel->
  "In[125]:=",ExpressionUUID->"408f5822-b3e1-499a-a1db-fd9de3c7095f"],

Cell[BoxData[
 StyleBox[
  RowBox[{"Layer", " ", "evaluator", " ", "function"}], "Subtitle",
  FontWeight->"Bold"]], "Input",ExpressionUUID->"18e0cb9c-f3b5-4b17-ac12-\
f994bd644d9a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", 
    RowBox[{"x_", ",", " ", "layer_Association"}], "]"}], ":=", 
   RowBox[{"layerEval", "[", 
    RowBox[{"x", ",", " ", 
     RowBox[{"Lookup", "[", 
      RowBox[{"layer", ",", " ", "\"\<LayerType\>\""}], "]"}], ",", " ", 
     RowBox[{"Lookup", "[", 
      RowBox[{"layer", ",", "\"\<Parameters\>\""}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", 
    RowBox[{"x_", ",", " ", "\"\<Sigmoid\>\"", ",", " ", "param_"}], "]"}], ":=",
    " ", 
   RowBox[{"1", "/", 
    RowBox[{"(", 
     RowBox[{"1", "+", 
      RowBox[{"Exp", "[", 
       RowBox[{"-", "x"}], "]"}]}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", 
    RowBox[{"x_", ",", " ", "\"\<Ramp\>\"", ",", " ", "param_"}], "]"}], " ", 
   ":=", " ", 
   RowBox[{
    RowBox[{"Abs", "[", "x", "]"}], "*", 
    RowBox[{"UnitStep", "[", "x", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", " ", 
    RowBox[{"x_", ",", " ", "\"\<LinearLayer\>\"", ",", " ", "param_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Dot", "[", 
    RowBox[{"x", ",", " ", 
     RowBox[{"param", "[", "\"\<Weights\>\"", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", " ", 
    RowBox[{"x_", ",", " ", "\"\<BinLayer\>\"", ",", " ", "param_"}], "]"}], ":=",
    " ", 
   RowBox[{"Dot", "[", 
    RowBox[{
     RowBox[{"hbForward", "[", 
      RowBox[{"x", ",", " ", "binAggression"}], "]"}], ",", " ", 
     RowBox[{"hbForward", "[", 
      RowBox[{
       RowBox[{"param", "[", "\"\<Weights\>\"", "]"}], ",", " ", 
       "binAggression"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", 
    RowBox[{"x_", ",", " ", "\"\<BinarizeLayer\>\"", ",", " ", "param_"}], 
    "]"}], ":=", " ", 
   RowBox[{"hbForward", "[", 
    RowBox[{"x", ",", " ", "binAggression"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"netEvaluate", "[", 
    RowBox[{"net_", ",", " ", "x_", ",", " ", "\"\<Training\>\""}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"FoldList", "[", 
    RowBox[{"layerEval", ",", " ", "x", ",", " ", "net"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"netEvaluate", "[", 
    RowBox[{"net_", ",", " ", "x_", ",", " ", "\"\<Test\>\""}], "]"}], " ", ":=",
    " ", 
   RowBox[{"Fold", "[", 
    RowBox[{"layerEval", ",", " ", "x", ",", " ", "net"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7395847492105637`*^9, 3.7395847618836575`*^9}, 
   3.7395885007537317`*^9},
 CellLabel->
  "In[1208]:=",ExpressionUUID->"b8b92af7-5dbe-417a-a655-801b6a2f9623"],

Cell[BoxData[
 StyleBox[
  RowBox[{"Test", "  ", "net", " ", "unroll"}], "Subtitle",
  FontWeight->"Bold"]], "Input",ExpressionUUID->"5772c199-fe65-4c5b-a8f0-\
2694d80ddcf1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Define", " ", "net", " ", "weights"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"w0", ",", " ", "w1", ",", " ", "w2"}], "}"}], " ", "=", " ", 
     RowBox[{"initializeWeights", "[", 
      RowBox[{
      "hiddennodes1", ",", " ", "hiddennodes2", ",", " ", "outputnodes"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"net", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}], ",",
          " ", 
         RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
          RowBox[{"<|", 
           RowBox[{"\"\<Weights\>\"", " ", "\[Rule]", " ", "w0"}], "|>"}]}]}],
         "|>"}], ",", "\[IndentingNewLine]", 
       RowBox[{"<|", 
        RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Ramp\>\""}], "|>"}], ",",
        "\[IndentingNewLine]", " ", 
       RowBox[{"<|", 
        RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<BinarizeLayer\>\""}], 
        "|>"}], ",", "\[IndentingNewLine]", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<BinLayer\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
          RowBox[{"<|", 
           RowBox[{"\"\<Weights\>\"", "\[Rule]", "w1"}], "|>"}]}]}], "|>"}], 
       ",", " ", "\[IndentingNewLine]", 
       RowBox[{"<|", 
        RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Ramp\>\""}], "|>"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}], ",",
          " ", 
         RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
          RowBox[{"<|", 
           RowBox[{"\"\<Weights\>\"", "\[Rule]", "w2"}], "|>"}]}]}], "|>"}], 
       ",", " ", "\[IndentingNewLine]", " ", 
       RowBox[{"<|", 
        RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Sigmoid\>\""}], "|>"}]}],
       "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"iteration", " ", "=", " ", "5"}], ";"}]}]}]], "Input",
 CellLabel->
  "In[1239]:=",ExpressionUUID->"408851c0-bec0-4673-9d26-e25294d95909"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"fullnet", " ", "=", " ", 
   RowBox[{"netEvaluate", "[", 
    RowBox[{"net", ",", " ", 
     RowBox[{"input", "[", 
      RowBox[{"[", 
       RowBox[{"iteration", ";;", 
        RowBox[{"iteration", "+", "batchsize"}]}], "]"}], "]"}], ",", " ", 
     "\"\<Training\>\""}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "@", "fullnet"}]}], "Input",
 CellChangeTimes->{{3.7395848200192647`*^9, 3.7395848216455097`*^9}},
 CellLabel->
  "In[1242]:=",ExpressionUUID->"142d3758-20f5-42e1-9cd6-7402b6791a58"],

Cell[BoxData[
 TemplateBox[{
  "Thread","tdlen",
   "\"Objects of unequal length in \\!\\(\\*RowBox[{RowBox[{\\\"{\\\", \
RowBox[{RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\
\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}]}], \
\\\"}\\\"}], \\\" \\\", RowBox[{\\\"{\\\", \\\"}\\\"}]}]\\) cannot be \
combined.\"",2,1242,267,30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.739588872529888*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"ccacd8c5-46fe-48fd-8b2a-123a27d08025"],

Cell[BoxData[
 TemplateBox[{
  "Transpose","nmtx",
   "\"The first two levels of \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"{\\\", \
RowBox[{\\\"1.0262716797194527`\\\", \\\",\\\", \\\"1.0262716797194527`\\\", \
\\\",\\\", \\\"1.0262716797194527`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \\\
\"0.9655804171732313`\\\", \\\",\\\", \\\"0.9655804171732313`\\\", \\\",\\\", \
\\\"0.9655804171732313`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \\\"0.`\\\", \
\\\",\\\", \\\"1.2208620919091457`\\\", \\\",\\\", \
\\\"1.2208620919091457`\\\", \\\",\\\", \\\"1.2208620919091457`\\\", \
\\\",\\\", \\\"0.`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \
\\\"0.32086433101720513`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \
\\\"0.8524153810285782`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", RowBox[{\\\"\
\[LeftSkeleton]\\\", \\\"15\\\", \\\"\[RightSkeleton]\\\"}], \\\",\\\", \
\\\"0.`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \
\\\"0.`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \
\\\"0.3739914300128209`\\\", \\\",\\\", \\\"0.7718769726542329`\\\", \
\\\",\\\", \\\"0.`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \\\"0.`\\\", \\\",\
\\\", \\\"0.24305126738968333`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \
\\\"0.24305126738968333`\\\", \\\",\\\", \\\"0.`\\\", \\\",\\\", \
\\\"1.3862799171011353`\\\", \\\",\\\", \\\"1.3862799171011353`\\\", \
\\\",\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \\\"78\\\", \
\\\"\[RightSkeleton]\\\"}]}], \\\"}\\\"}], \\\",\\\", RowBox[{\\\"\
\[LeftSkeleton]\\\", \\\"15\\\", \\\"\[RightSkeleton]\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"\[LeftSkeleton]\\\", \\\"18\\\", \\\"\
\[RightSkeleton]\\\"}], \\\",\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \
\\\"50\\\", \\\"\[RightSkeleton]\\\"}]}], \\\"}\\\"}]}], \\\"}\\\"}], \\\",\\\
\", RowBox[{\\\"\[LeftSkeleton]\\\", \\\"1\\\", \\\"\[RightSkeleton]\\\"}]}], \
\\\"}\\\"}]\\) cannot be transposed.\"",2,1242,268,30267033037033960260,
   "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.7395888727183847`*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"8cb19c82-adc9-4618-97fc-ce5947eb3ff7"],

Cell[BoxData[
 TemplateBox[{
  "Join","heads",
   "\"Heads \\!\\(\\*RowBox[{\\\"List\\\"}]\\) and \\!\\(\\*RowBox[{\\\"Times\
\\\"}]\\) at positions \\!\\(\\*RowBox[{\\\"1\\\"}]\\) and \
\\!\\(\\*RowBox[{\\\"2\\\"}]\\) are expected to be the same.\"",2,1242,269,
   30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.7395888728061514`*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"9a1f8321-76c0-4e16-836c-4233e703354f"],

Cell[BoxData[
 TemplateBox[{
  "Part","partw",
   "\"Part \\!\\(\\*RowBox[{\\\"2\\\"}]\\) of \
\\!\\(\\*RowBox[{\\\"Transpose\\\", \\\"[\\\", RowBox[{\\\"Join\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"{\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \
\\\"1\\\", \\\"\[RightSkeleton]\\\"}], \\\"}\\\"}], \\\",\\\", \
RowBox[{RowBox[{\\\"{\\\", \\\"}\\\"}], \\\" \\\", RowBox[{\\\"{\\\", \
RowBox[{RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\
\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}]}], \
\\\"}\\\"}]}]}], \\\"]\\\"}], \\\"]\\\"}]\\) does not exist.\"",2,1242,270,
   30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.7395888729527597`*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"038b7b56-b718-449d-8bec-486a9dd591d1"],

Cell[BoxData[
 TemplateBox[{
  "Transpose","nmtx",
   "\"The first two levels of \\!\\(\\*RowBox[{\\\"{\\\", \\\"}\\\"}]\\) \
cannot be transposed.\"",2,1242,271,30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.739588873119316*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"e98cca68-6d5a-4487-a72c-d998c2318bb7"],

Cell[BoxData[
 TemplateBox[{
  "Part","partw",
   "\"Part \\!\\(\\*RowBox[{\\\"2\\\"}]\\) of \
\\!\\(\\*RowBox[{\\\"Transpose\\\", \\\"[\\\", RowBox[{\\\"Join\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"{\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \
\\\"1\\\", \\\"\[RightSkeleton]\\\"}], \\\"}\\\"}], \\\",\\\", \
RowBox[{RowBox[{\\\"{\\\", \\\"}\\\"}], \\\" \\\", RowBox[{\\\"{\\\", \
RowBox[{RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\
\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}]}], \
\\\"}\\\"}]}]}], \\\"]\\\"}], \\\"]\\\"}]\\) does not exist.\"",2,1242,272,
   30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.739588873315788*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"6fd3c48e-08e1-4d50-af50-a4c5b4ca47cc"],

Cell[BoxData[
 TemplateBox[{
  "Transpose","nmtx",
   "\"The first two levels of \\!\\(\\*RowBox[{\\\"{\\\", \\\"}\\\"}]\\) \
cannot be transposed.\"",2,1242,273,30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.739588873483345*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"162cd97b-eec5-492a-94b7-5240f7a13be4"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Transpose\\\", \\\"::\\\
\", \\\"nmtx\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"",2,1242,274,30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.7395888735770864`*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"00e5b48d-a794-4964-aa74-a1c2fc714c0b"],

Cell[BoxData[
 TemplateBox[{
  "Part","partw",
   "\"Part \\!\\(\\*RowBox[{\\\"2\\\"}]\\) of \
\\!\\(\\*RowBox[{\\\"Transpose\\\", \\\"[\\\", RowBox[{\\\"Join\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"{\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \
\\\"1\\\", \\\"\[RightSkeleton]\\\"}], \\\"}\\\"}], \\\",\\\", \
RowBox[{RowBox[{\\\"{\\\", \\\"}\\\"}], \\\" \\\", RowBox[{\\\"{\\\", \
RowBox[{RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\
\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}]}], \
\\\"}\\\"}]}]}], \\\"]\\\"}], \\\"]\\\"}]\\) does not exist.\"",2,1242,275,
   30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.739588873741647*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"759735fe-d5e8-4cf0-af85-4282ff847fe3"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Part\\\", \\\"::\\\", \
\\\"partw\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"",2,1242,276,30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.739588873880278*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"8b08684f-58ab-4d49-aadc-76ce2edcb300"],

Cell[BoxData[
 TemplateBox[{
  "Join","heads",
   "\"Heads \\!\\(\\*RowBox[{\\\"List\\\"}]\\) and \\!\\(\\*RowBox[{\\\"Times\
\\\"}]\\) at positions \\!\\(\\*RowBox[{\\\"1\\\"}]\\) and \
\\!\\(\\*RowBox[{\\\"2\\\"}]\\) are expected to be the same.\"",2,1242,277,
   30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.7395888739830065`*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"883d476a-fe79-4e1f-80c4-67d4a6e5e480"],

Cell[BoxData[
 TemplateBox[{
  "Join","heads",
   "\"Heads \\!\\(\\*RowBox[{\\\"List\\\"}]\\) and \\!\\(\\*RowBox[{\\\"Times\
\\\"}]\\) at positions \\!\\(\\*RowBox[{\\\"1\\\"}]\\) and \
\\!\\(\\*RowBox[{\\\"2\\\"}]\\) are expected to be the same.\"",2,1242,278,
   30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.7395888740807395`*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"202720bb-6f93-4cc7-b93b-24dc994c5f3d"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Join\\\", \\\"::\\\", \
\\\"heads\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"",2,1242,279,30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.739588874167512*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"9cd831f0-4aff-4710-9d77-77e098e8b8cc"],

Cell[BoxData[
 TemplateBox[{
  "Thread","tdlen",
   "\"Objects of unequal length in \\!\\(\\*RowBox[{RowBox[{\\\"{\\\", \
RowBox[{RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\
\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", \
RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\
\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \\\"}\\\"}], \\\",\\\", RowBox[{\\\
\"\[LeftSkeleton]\\\", \\\"78\\\", \\\"\[RightSkeleton]\\\"}]}], \\\"}\\\"}], \
\\\" \\\", RowBox[{\\\"{\\\", \\\"}\\\"}]}]\\) cannot be combined.\"",2,1242,
   280,30267033037033960260,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739588718882163*^9, 3.739588877003919*^9},
 CellLabel->
  "During evaluation of \
In[1242]:=",ExpressionUUID->"676159cf-1c6f-48c7-8f1f-578e0b36d5ad"],

Cell[BoxData[
 RowBox[{"{", "8", "}"}]], "Output",
 CellChangeTimes->{3.739588724966886*^9, 3.7395888770089073`*^9},
 CellLabel->
  "Out[1243]=",ExpressionUUID->"4e0e2bd1-8d70-4520-974a-7c4128029932"]
}, Open  ]],

Cell[BoxData[
 StyleBox[
  RowBox[{"Back", " ", "Propagation", " ", "algorithm", " "}], "Subtitle",
  FontWeight->"Bold"]], "Input",
 CellChangeTimes->{
  3.739584835633086*^9},ExpressionUUID->"0a449b43-c3d4-4daf-b7b4-\
33579ede53ba"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"backProp", "[", 
     RowBox[{
     "fullnet_", ",", " ", "w0_", ",", " ", "w1_", ",", " ", "w2_", ",", " ", 
      "input_", ",", " ", "target_", ",", " ", "l3M_", ",", " ", "l3V_", ",", 
      "  ", "l2M_", ",", " ", "l1M_", ",", " ", "l2V_", ",", " ", "l1V_", " ",
       ",", " ", "iteration_", ",", " ", "lr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "l3Error", ",", " ", "l3Delta", ",", " ", "l2Error", ",", " ", 
        "l2Delta", ",", " ", "l1Error", ",", " ", "l1Delta", ",", " ", "g2", 
        ",", " ", "g1", ",", " ", "g0", ",", " ", "l0", ",", " ", "l1", ",", 
        " ", "l2", ",", " ", "l3", ",", " ", "l1MC", ",", " ", "l1VC", ",", 
        " ", "l2MC", ",", " ", "l2VC", ",", " ", "l3MC", ",", " ", "l3VC", 
        ",", " ", "l3MT", ",", " ", "l2MT", ",", " ", "l1MT", ",", " ", 
        "l3VT", ",", " ", "l2VT", ",", " ", "l1VT", ",", " ", "w2T", ",", " ",
         "w1T", ",", " ", "w0T", ",", " ", "w2UDT", ",", "  ", "w1UDT", ",", 
        " ", "w0UDT"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"l3MT", " ", "=", " ", "l3M"}], ";", " ", 
       RowBox[{"l3VT", " ", "=", " ", "l3V"}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"l2MT", " ", "=", " ", "l2M"}], ";", " ", 
       RowBox[{"l2VT", " ", "=", " ", "l2V"}], ";", "\[IndentingNewLine]", 
       RowBox[{"l1MT", " ", "=", " ", "l1M"}], ";", " ", 
       RowBox[{"l1VT", " ", "=", " ", "l1V"}], ";", "\[IndentingNewLine]", 
       RowBox[{"w2T", " ", "=", " ", "w2"}], ";", " ", 
       RowBox[{"w1T", " ", "=", " ", "w1"}], ";", " ", 
       RowBox[{"w0T", " ", "=", " ", "w0"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"l3Error", " ", "=", " ", 
        RowBox[{
         RowBox[{"fullnet", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], " ", "-", " ", "target"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"l3Delta", " ", "=", " ", 
        RowBox[{"l3Error", "*", 
         RowBox[{"sigmDeriv", "[", 
          RowBox[{"fullnet", "[", 
           RowBox[{"[", 
            RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l2Error", " ", "=", " ", 
        RowBox[{"hbBackward", "@", 
         RowBox[{"Dot", "[", 
          RowBox[{"l3Delta", ",", " ", 
           RowBox[{"Transpose", "@", 
            RowBox[{"hbForward", "[", "w2", "]"}]}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l2Delta", " ", "=", " ", 
        RowBox[{"l2Error", "*", 
         RowBox[{"rampDeriv", "[", 
          RowBox[{"fullnet", "[", 
           RowBox[{"[", "6", "]"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l1Error", " ", "=", " ", 
        RowBox[{"hbBackward", "@", 
         RowBox[{"Dot", "[", 
          RowBox[{"l2Delta", ",", " ", 
           RowBox[{"Transpose", "@", 
            RowBox[{"hbForward", "[", "w1", "]"}]}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l1Delta", " ", "=", " ", 
        RowBox[{"l1Error", "*", 
         RowBox[{"rampDeriv", "[", 
          RowBox[{"fullnet", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"g2", " ", "=", " ", 
        RowBox[{"Dot", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"fullnet", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "]"}], ",", " ", "l3Delta"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"g1", " ", "=", " ", 
        RowBox[{"Dot", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"fullnet", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}], ",", " ", "l2Delta"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"g0", " ", "=", " ", 
        RowBox[{"Dot", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", "input", "]"}], ",", " ", "l1Delta"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"l3MT", " ", "=", " ", 
        RowBox[{
         RowBox[{"l3MT", "*", "b1"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "b1"}], ")"}], "*", "g2"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l3VT", " ", "=", " ", 
        RowBox[{
         RowBox[{"l3VT", "*", "b2"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "b2"}], ")"}], "*", 
          RowBox[{"(", 
           RowBox[{"g2", "*", "g2"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"l2MT", " ", "=", " ", 
        RowBox[{
         RowBox[{"l2MT", "*", "b1"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "b1"}], ")"}], "*", "g1"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l2VT", " ", "=", " ", 
        RowBox[{
         RowBox[{"l2VT", "*", "b2"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "b2"}], ")"}], "*", 
          RowBox[{"(", 
           RowBox[{"g1", "*", "g1"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"l1MT", " ", "=", " ", 
        RowBox[{
         RowBox[{"l1MT", "*", "b1"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "b1"}], ")"}], "*", "g0"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l1VT", " ", "=", " ", 
        RowBox[{
         RowBox[{"l1VT", "*", "b2"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "b2"}], ")"}], "*", 
          RowBox[{"(", 
           RowBox[{"g0", "*", "g0"}], ")"}]}]}]}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"l1MC", " ", "=", " ", 
        RowBox[{"l1MT", "/", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"b1", "^", "iteration"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"l1VC", " ", "=", " ", 
        RowBox[{"l1VT", "/", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"b2", "^", "iteration"}]}], ")"}]}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"l2MC", " ", "=", " ", 
        RowBox[{"l2MT", "/", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"b1", "^", "iteration"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"l2VC", " ", "=", " ", 
        RowBox[{"l2VT", "/", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"b2", "^", "iteration"}]}], ")"}]}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"l3MC", " ", "=", " ", 
        RowBox[{"l3MT", "/", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"b1", "^", "iteration"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"l3VC", " ", "=", " ", 
        RowBox[{"l3VT", "/", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"b2", "^", "iteration"}]}], ")"}]}]}], ";", " ", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"w2UDT", " ", "=", " ", 
        RowBox[{"l3MC", "/", 
         RowBox[{"(", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"l3VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w1UDT", " ", "=", " ", 
        RowBox[{"l2MC", "/", 
         RowBox[{"(", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"l2VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w0UDT", " ", "=", " ", 
        RowBox[{"l1MC", "/", 
         RowBox[{"(", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"l1VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], ";", 
       " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"w2T", " ", "-=", " ", 
        RowBox[{"learningrate", "*", "w2UDT"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"w1T", " ", "-=", " ", 
        RowBox[{"learningrate", "*", "w1UDT"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"w0T", " ", "-=", " ", 
        RowBox[{"learningrate", "*", "w0UDT"}]}], ";", " ", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
         "w0T", ",", " ", "w1T", ",", " ", "w2T", ",", " ", "l3MT", ",", " ", 
          "l3VT", ",", " ", "l2MT", ",", " ", "l1MT", ",", " ", "l2VT", ",", 
          " ", "l1VT"}], "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 StyleBox[
  RowBox[{"Accuracy", " ", "Testing", " ", "Function"}], "Subtitle",
  FontWeight->"Bold"]}], "Input",
 CellChangeTimes->{{3.7395848417399826`*^9, 3.739584898375646*^9}, {
  3.7395883812874994`*^9, 
  3.739588390980565*^9}},ExpressionUUID->"de1e4a2d-a305-4f3e-b1c0-\
5ecad2be69f7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"test", "[", 
    RowBox[{
    "net_", ",", " ", "input_", ",", " ", "target_", ",", " ", "testnum_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Return", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"netEvaluate", "[", 
          RowBox[{"net", ",", " ", 
           RowBox[{"input", "[", 
            RowBox[{"[", "testnum", "]"}], "]"}], ",", " ", "\"\<Test\>\""}], 
          "]"}], ",", 
         RowBox[{"Max", "[", 
          RowBox[{"netEvaluate", "[", 
           RowBox[{"net", ",", " ", 
            RowBox[{"input", "[", 
             RowBox[{"[", "testnum", "]"}], "]"}], ",", " ", "\"\<Test\>\""}],
            "]"}], "]"}]}], "]"}], " ", "-", " ", "1"}], ",", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"target", "[", 
          RowBox[{"[", "testnum", "]"}], "]"}], ",", " ", "1"}], "]"}], " ", 
       "-", " ", "1"}]}], "}"}], "]"}]}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"accTest", "[", 
    RowBox[{
    "net_", ",", " ", "input_", ",", " ", "target_", ",", " ", "numTest_"}], 
    "]"}], " ", ":=", " ", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", " ", "y"}], "}"}], ",", " ", 
     RowBox[{
      RowBox[{"y", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"x", "=", "1"}], ",", " ", 
        RowBox[{"x", "\[LessEqual]", "numTest"}], ",", " ", 
        RowBox[{"x", "++"}], ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"netEvaluate", "[", 
              RowBox[{"net", ",", " ", 
               RowBox[{"input", "[", 
                RowBox[{"[", "x", "]"}], "]"}], ",", " ", "\"\<Test\>\""}], 
              "]"}], ",", " ", 
             RowBox[{"Max", "[", 
              RowBox[{"netEvaluate", "[", 
               RowBox[{"net", ",", " ", 
                RowBox[{"input", "[", 
                 RowBox[{"[", "x", "]"}], "]"}], ",", " ", "\"\<Test\>\""}], 
               "]"}], "]"}]}], "]"}], "==", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"target", "[", 
              RowBox[{"[", "x", "]"}], "]"}], ",", " ", "1"}], "]"}]}], " ", 
          ",", 
          RowBox[{"y", "++"}]}], "]"}]}], "]"}], ";", " ", 
      RowBox[{"Return", "[", 
       RowBox[{"y", "/", "numTest"}], "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{3.7395848558484273`*^9, 
  3.739584902077775*^9},ExpressionUUID->"277b590c-4871-469f-93ef-\
a7ddbc9cdee3"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"Network", " ", "run", " ", "function", " "}], "Subtitle",
   FontWeight->"Bold"]}]], "Input",ExpressionUUID->"2e022dc5-dbec-46fa-a7dd-\
e38d1d7f6e93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"runNet", "[", 
   RowBox[{
   "input_", ",", " ", "target_", ",", " ", "testinp_", ",", " ", "testtar_", 
    ",", " ", "import_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "iteration", ",", " ", "fullnet", ",", " ", "w0", ",", " ", "w1", ",", 
      " ", "w2", ",", "l3M", ",", " ", "l3V", ",", " ", "l2M", ",", " ", 
      "l1M", ",", " ", "l2V", ",", " ", "l1V", ",", "\[IndentingNewLine]", 
      "l3Error", ",", " ", "l3Delta", ",", "l2Error", ",", " ", "l2Delta", 
      ",", " ", "l1Error", ",", " ", "l1Delta", ",", " ", "g1", ",", " ", 
      "g0", ",", " ", "l0", ",", " ", "l1", ",", " ", "l2", ",", "l3", ",", 
      " ", "l1MC", ",", " ", "l1VC", ",", " ", "l2MC", ",", " ", "l2VC", ",", 
      " ", "l3MC", ",", " ", "l3VC", ",", " ", "w2UDT", ",", " ", "w1UDT", 
      ",", " ", "w0UDT", ",", " ", "epoch", ",", " ", "lr"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"import", " ", "\[Equal]", " ", "0"}], ",", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"w0", ",", " ", "w1", ",", " ", "w2"}], "}"}], " ", "=", " ", 
        RowBox[{"initializeWeights", "[", 
         RowBox[{"hiddennodes1", ",", " ", "hiddennodes2", ",", " ", "10"}], 
         "]"}]}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"w0", ",", " ", "w1", ",", " ", "w2"}], "}"}], " ", "=", 
         " ", 
         RowBox[{"Import", "[", "\"\<MNISTweightsAggressive.dat\>\"", "]"}]}],
         ";", " ", 
        RowBox[{"w0", " ", "=", " ", 
         RowBox[{"ArrayReshape", "[", 
          RowBox[{"784", ",", " ", "hiddennodes1"}], "]"}]}], ";", " ", 
        RowBox[{"w1", " ", "=", " ", 
         RowBox[{"ArrayReshape", "[", 
          RowBox[{"hiddennodes1", ",", " ", "hiddennodes2"}], "]"}]}], ";", 
        " ", 
        RowBox[{"w2", " ", "=", " ", 
         RowBox[{"ArrayReshape", "[", 
          RowBox[{"hiddennodes2", ",", " ", "outputnodes"}], "]"}]}], ";"}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"epoch", " ", "=", " ", "epochs"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"l3M", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l3V", " ", "=", " ", "0"}], ";", 
     RowBox[{"l2M", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l1M", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l2V", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l1V", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "Iterator", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"iteration", " ", "=", " ", "1"}], ",", " ", 
       RowBox[{"iteration", "\[LessEqual]", " ", "iterations"}], ",", " ", 
       RowBox[{"iteration", "+=", "batchsize"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "If", " ", "iteration", " ", "ends", " ", "and", " ", "epoch", " ", 
          "isnt", " ", "0"}], ",", " ", 
         RowBox[{"reset", " ", "iteration"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"And", "[", 
           RowBox[{
            RowBox[{"iteration", " ", "\[GreaterEqual]", " ", 
             RowBox[{"iterations", " ", "-", " ", "32"}]}], ",", " ", 
            RowBox[{"epoch", "\[GreaterEqual]", "1"}]}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"iteration", "=", "1"}], ";", " ", 
           RowBox[{"epoch", "-=", "1"}], ";", " ", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<epoch \>\"", "epoch"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Training acc\>\"", " ", 
             StyleBox[
              RowBox[{"N", "[", 
               RowBox[{"accTest", "[", 
                RowBox[{
                "net", ",", " ", "input", ",", " ", "target", ",", " ", 
                 "600"}], "]"}], "]"}],
              FontWeight->"Bold"]}], 
            StyleBox["]",
             FontWeight->"Bold"]}], 
           StyleBox[";",
            FontWeight->"Bold"], 
           StyleBox["\[IndentingNewLine]",
            FontWeight->"Bold"], 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Test acc\>\"", " ", 
             RowBox[{"N", "[", 
              RowBox[{"accTest", "[", 
               RowBox[{
               "net", ",", " ", "testinp", ",", " ", "testtar", ",", " ", 
                "100"}], "]"}], "]"}]}], "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Redefine", " ", "net", " ", "weights"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"net", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}], 
             ",", " ", 
             RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
              RowBox[{"<|", 
               RowBox[{"\"\<Weights\>\"", " ", "\[Rule]", " ", "w0"}], 
               "|>"}]}]}], "|>"}], ",", "\[IndentingNewLine]", 
           RowBox[{"<|", 
            RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Ramp\>\""}], "|>"}], 
           ",", "\[IndentingNewLine]", " ", 
           RowBox[{"<|", 
            RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<BinarizeLayer\>\""}],
             "|>"}], ",", "\[IndentingNewLine]", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<BinLayer\>\""}], 
             ",", " ", 
             RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
              RowBox[{"<|", 
               RowBox[{"\"\<Weights\>\"", "\[Rule]", "w1"}], "|>"}]}]}], 
            "|>"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"<|", 
            RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Ramp\>\""}], "|>"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<BinLayer\>\""}], 
             ",", " ", 
             RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
              RowBox[{"<|", 
               RowBox[{"\"\<Weights\>\"", "\[Rule]", "w2"}], "|>"}]}]}], 
            "|>"}], ",", " ", "\[IndentingNewLine]", " ", 
           RowBox[{"<|", 
            RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Sigmoid\>\""}], 
            "|>"}]}], "\[IndentingNewLine]", "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Evaluate", " ", "the", " ", "net"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"fullnet", " ", "=", " ", 
         RowBox[{"netEvaluate", "[", 
          RowBox[{"net", ",", " ", 
           RowBox[{"input", "[", 
            RowBox[{"[", 
             RowBox[{"iteration", ";;", 
              RowBox[{"iteration", "+", "batchsize"}]}], "]"}], "]"}], ",", 
           " ", "\"\<Training\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Back", " ", "prop"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"lr", " ", "=", " ", 
         RowBox[{"learningrate", "*", 
          RowBox[{"(", 
           RowBox[{"1", "/", 
            RowBox[{"(", 
             RowBox[{"1", "+", 
              RowBox[{"0.1", "*", "epoch"}]}], ")"}]}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "w0", ",", " ", "w1", ",", "w2", ",", " ", "l3M", ",", " ", "l3V", 
           ",", " ", "l2M", ",", " ", "l1M", ",", " ", "l2V", ",", " ", 
           "l1V"}], "}"}], " ", "=", " ", 
         RowBox[{"backProp", "[", 
          RowBox[{
          "fullnet", ",", " ", "w0", ",", " ", "w1", ",", " ", "w2", ",", " ", 
           RowBox[{"input", "[", 
            RowBox[{"[", 
             RowBox[{"iteration", ";;", 
              RowBox[{"iteration", "+", "batchsize"}]}], "]"}], "]"}], ",", 
           " ", 
           RowBox[{"target", "[", 
            RowBox[{"[", 
             RowBox[{"iteration", ";;", 
              RowBox[{"iteration", "+", "batchsize"}]}], "]"}], "]"}], ",", 
           " ", "l3M", ",", " ", "l3V", ",", "  ", "l2M", ",", " ", "l1M", 
           ",", " ", "l2V", ",", " ", "l1V", ",", " ", "iteration", ",", " ", 
           "lr"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"w0", ",", " ", "w1", ",", " ", "w2"}], "}"}], "]"}], ";"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7395883114802604`*^9, 
  3.7395883309322195`*^9}},ExpressionUUID->"ed0d687e-ead2-4ae8-8b3a-\
260e037d746f"]
},
WindowSize->{958, 1028},
WindowMargins->{{-7, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 7, 2018)",
StyleDefinitions->"ReverseColor.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[561, 20, 252, 6, 44, "Input",ExpressionUUID->"6333c42e-87f7-4bf2-9c52-ef4b9536a477"],
Cell[816, 28, 4380, 114, 238, "Input",ExpressionUUID->"8229eef7-ddc5-47a6-a2f7-97999efcea5e"],
Cell[5199, 144, 277, 7, 44, "Input",ExpressionUUID->"2d85b99e-e859-45fe-aa2a-950054761b9e"],
Cell[5479, 153, 2566, 63, 162, "Input",ExpressionUUID->"2981b838-8492-4e60-a8e1-78f57677bf64"],
Cell[8048, 218, 253, 6, 44, "Input",ExpressionUUID->"05e424f5-5bc8-4626-b94a-30e25d2d6108"],
Cell[8304, 226, 1812, 41, 238, "Input",ExpressionUUID->"a3598894-949b-4a67-b2de-57863b0c499b"],
Cell[10119, 269, 506, 15, 44, "Input",ExpressionUUID->"343c3ee5-345a-40f1-8669-79e0ae084770"],
Cell[10628, 286, 17811, 427, 922, "Input",ExpressionUUID->"f6633890-c759-4ccb-88de-5f880763ddc6"],
Cell[CellGroupData[{
Cell[28464, 717, 1364, 28, 105, "Input",ExpressionUUID->"0c819410-cf50-4d93-9f66-11fa5c112620"],
Cell[29831, 747, 3544, 77, 215, "Output",ExpressionUUID->"f119378d-6aa0-4a48-9aa7-72cb61c8e871"],
Cell[33378, 826, 3536, 77, 215, "Output",ExpressionUUID->"ce34c885-41a5-46d4-bab2-8971e67b5ae4"],
Cell[36917, 905, 3531, 77, 215, "Output",ExpressionUUID->"e03c4874-c956-4c8c-a4f6-73a095546d80"]
}, Open  ]],
Cell[40463, 985, 170, 4, 44, "Input",ExpressionUUID->"53fda235-5223-4e36-9c0b-ec505edc1d68"],
Cell[40636, 991, 501, 14, 48, "Input",ExpressionUUID->"408f5822-b3e1-499a-a1db-fd9de3c7095f"],
Cell[41140, 1007, 182, 4, 44, "Input",ExpressionUUID->"18e0cb9c-f3b5-4b17-ac12-f994bd644d9a"],
Cell[41325, 1013, 2776, 79, 162, "Input",ExpressionUUID->"b8b92af7-5dbe-417a-a655-801b6a2f9623"],
Cell[44104, 1094, 174, 4, 44, "Input",ExpressionUUID->"5772c199-fe65-4c5b-a8f0-2694d80ddcf1"],
Cell[44281, 1100, 2260, 57, 219, "Input",ExpressionUUID->"408851c0-bec0-4673-9d26-e25294d95909"],
Cell[CellGroupData[{
Cell[46566, 1161, 555, 13, 48, "Input",ExpressionUUID->"142d3758-20f5-42e1-9cd6-7402b6791a58"],
Cell[47124, 1176, 1210, 20, 23, "Message",ExpressionUUID->"ccacd8c5-46fe-48fd-8b2a-123a27d08025"],
Cell[48337, 1198, 2203, 35, 75, "Message",ExpressionUUID->"8cb19c82-adc9-4618-97fc-ce5947eb3ff7"],
Cell[50543, 1235, 510, 11, 21, "Message",ExpressionUUID->"9a1f8321-76c0-4e16-836c-4233e703354f"],
Cell[51056, 1248, 1449, 24, 23, "Message",ExpressionUUID->"038b7b56-b718-449d-8bec-486a9dd591d1"],
Cell[52508, 1274, 404, 9, 23, "Message",ExpressionUUID->"e98cca68-6d5a-4487-a72c-d998c2318bb7"],
Cell[52915, 1285, 1447, 24, 23, "Message",ExpressionUUID->"6fd3c48e-08e1-4d50-af50-a4c5b4ca47cc"],
Cell[54365, 1311, 404, 9, 23, "Message",ExpressionUUID->"162cd97b-eec5-492a-94b7-5240f7a13be4"],
Cell[54772, 1322, 476, 10, 21, "Message",ExpressionUUID->"00e5b48d-a794-4964-aa74-a1c2fc714c0b"],
Cell[55251, 1334, 1447, 24, 23, "Message",ExpressionUUID->"759735fe-d5e8-4cf0-af85-4282ff847fe3"],
Cell[56701, 1360, 470, 10, 21, "Message",ExpressionUUID->"8b08684f-58ab-4d49-aadc-76ce2edcb300"],
Cell[57174, 1372, 510, 11, 21, "Message",ExpressionUUID->"883d476a-fe79-4e1f-80c4-67d4a6e5e480"],
Cell[57687, 1385, 510, 11, 21, "Message",ExpressionUUID->"202720bb-6f93-4cc7-b93b-24dc994c5f3d"],
Cell[58200, 1398, 470, 10, 21, "Message",ExpressionUUID->"9cd831f0-4aff-4710-9d77-77e098e8b8cc"],
Cell[58673, 1410, 2755, 40, 57, "Message",ExpressionUUID->"676159cf-1c6f-48c7-8f1f-578e0b36d5ad"],
Cell[61431, 1452, 200, 4, 32, "Output",ExpressionUUID->"4e0e2bd1-8d70-4520-974a-7c4128029932"]
}, Open  ]],
Cell[61646, 1459, 234, 6, 44, "Input",ExpressionUUID->"0a449b43-c3d4-4daf-b7b4-33579ede53ba"],
Cell[61883, 1467, 8914, 211, 836, "Input",ExpressionUUID->"de1e4a2d-a305-4f3e-b1c0-5ecad2be69f7"],
Cell[70800, 1680, 2724, 73, 162, "Input",ExpressionUUID->"277b590c-4871-469f-93ef-a7ddbc9cdee3"],
Cell[73527, 1755, 221, 5, 55, "Input",ExpressionUUID->"2e022dc5-dbec-46fa-a7dd-e38d1d7f6e93"],
Cell[73751, 1762, 8794, 198, 675, "Input",ExpressionUUID->"ed0d687e-ead2-4ae8-8b3a-260e037d746f"]
}
]
*)

